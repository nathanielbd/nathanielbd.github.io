<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="Learning Python Exceptions through Lenstra&#39;s Algorithm">
<meta itemprop="description" content="This is part two of my series on Lenstra&rsquo;s Algorithm. See part one here for the intuition for the algorithm.
 In part one, we saw that Lenstra&rsquo;s Algorithm can intuitively be understood as an algorithm literally built to fail. We repeatedly add a point to itself on an elliptic curve modulo the number to be factored and wait until a failure to compute a modular multiplicative inverse occurs. Because when that happens, it means that the GCD of the number to be factored and another number is non-zero.">
<meta itemprop="datePublished" content="2022-03-30T16:04:16-05:00" />
<meta itemprop="dateModified" content="2022-03-30T16:04:16-05:00" />
<meta itemprop="wordCount" content="2360">



<meta itemprop="keywords" content="programming,computational number theory," /><meta property="og:title" content="Learning Python Exceptions through Lenstra&#39;s Algorithm" />
<meta property="og:description" content="This is part two of my series on Lenstra&rsquo;s Algorithm. See part one here for the intuition for the algorithm.
 In part one, we saw that Lenstra&rsquo;s Algorithm can intuitively be understood as an algorithm literally built to fail. We repeatedly add a point to itself on an elliptic curve modulo the number to be factored and wait until a failure to compute a modular multiplicative inverse occurs. Because when that happens, it means that the GCD of the number to be factored and another number is non-zero." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nathanielbd.github.io/posts/python-exceptions-thru-lenstras-algo/" />
<meta property="article:published_time" content="2022-03-30T16:04:16-05:00" />
<meta property="article:modified_time" content="2022-03-30T16:04:16-05:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Learning Python Exceptions through Lenstra&#39;s Algorithm"/>
<meta name="twitter:description" content="This is part two of my series on Lenstra&rsquo;s Algorithm. See part one here for the intuition for the algorithm.
 In part one, we saw that Lenstra&rsquo;s Algorithm can intuitively be understood as an algorithm literally built to fail. We repeatedly add a point to itself on an elliptic curve modulo the number to be factored and wait until a failure to compute a modular multiplicative inverse occurs. Because when that happens, it means that the GCD of the number to be factored and another number is non-zero."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>Learning Python Exceptions through Lenstra&#39;s Algorithm</title>
	<link rel="stylesheet" href="https://nathanielbd.github.io/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css" integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin="anonymous">
	
	
	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<style>
 
.gist{font-size: 18px}.gist-meta, .gist-file, .octotree_toggle, ul.comparison-list > li.title,button.button, a.button, span.button, button.minibutton, a.minibutton,span.minibutton, .clone-url-button > .clone-url-link{background: linear-gradient(#202020, #181818) !important;border-color: #383838 !important;border-radius: 0 0 3px 3px !important;text-shadow: none !important;color: #b5b5b5 !important}.markdown-format pre, .markdown-body pre, .markdown-format .highlight pre,.markdown-body .highlight pre, body.blog pre, #facebox pre, .blob-expanded,.terminal, .copyable-terminal, #notebook .input_area, .blob-code-context,.markdown-format code, body.blog pre > code, .api pre, .api code,.CodeMirror,.highlight{background-color: #1D1F21!important;color: #C5C8C6!important}.gist .blob-code{padding: 1px 10px !important;text-align: left;background: #000;border: 0}::selection{background: #24890d;color: #fff;text-shadow: none}::-moz-selection{background: #24890d;color: #fff;text-shadow: none}.blob-num{padding: 10px 8px 9px;text-align: right;color: #6B6B6B!important;border: 0}.blob-code,.blob-code-inner{color: #C5C8C6!important}.pl-c,.pl-c span{color: #969896!important;font-style: italic!important}.pl-c1{color: #DE935F!important}.pl-cce{color: #DE935F!important}.pl-cn{color: #DE935F!important}.pl-coc{color: #DE935F!important}.pl-cos{color: #B5BD68!important}.pl-e{color: #F0C674!important}.pl-ef{color: #F0C674!important}.pl-en{color: #F0C674!important}.pl-enc{color: #DE935F!important}.pl-enf{color: #F0C674!important}.pl-enm{color: #F0C674!important}.pl-ens{color: #DE935F!important}.pl-ent{color: #B294BB!important}.pl-entc{color: #F0C674!important}.pl-enti{color: #F0C674!important;font-weight: 700!important}.pl-entm{color: #C66!important}.pl-eoa{color: #B294BB!important}.pl-eoac{color: #C66!important}.pl-eoac .pl-pde{color: #C66!important}.pl-eoai{color: #B294BB!important}.pl-eoai .pl-pde{color: #B294BB!important}.pl-eoi{color: #F0C674!important}.pl-k{color: #B294BB!important}.pl-ko{color: #B294BB!important}.pl-kolp{color: #B294BB!important}.pl-kos{color: #DE935F!important}.pl-kou{color: #DE935F!important}.pl-mai .pl-sf{color: #C66!important}.pl-mb{color: #B5BD68!important;font-weight: 700!important}.pl-mc{color: #B294BB!important}.pl-mh .pl-pdh{color: #DE935F!important}.pl-mi{color: #B294BB!important;font-style: italic!important}.pl-ml{color: #B5BD68!important}.pl-mm{color: #C66!important}.pl-mp{color: #81A2BE!important}.pl-mp1 .pl-sf{color: #81A2BE!important}.pl-mq{color: #DE935F!important}.pl-mr{color: #B294BB!important}.pl-ms{color: #B294BB!important}.pl-pdb{color: #B5BD68!important;font-weight: 700!important}.pl-pdc{color: #969896!important;font-style: italic!important}.pl-pdc1{color: #DE935F!important}.pl-pde{color: #DE935F!important}.pl-pdi{color: #B294BB!important;font-style: italic!important}.pl-pds{color: #B5BD68!important}.pl-pdv{color: #C66!important}.pl-pse{color: #DE935F!important}.pl-pse .pl-s2{color: #DE935F!important}.pl-s{color: #B294BB!important}.pl-s1{color: #B5BD68!important}.pl-s2{color: #c5c8c6!important}.pl-mp .pl-s3{color: #B294BB!important}.pl-s3{color: #81a2be!important}.pl-sc{color: #c5c8c6!important}.pl-scp{color: #DE935F!important}.pl-sf{color: #DAD085!important}.pl-smc{color: #F0C674!important}.pl-smi{color: #c5c8c6!important}.pl-smp{color: #c5c8c6!important}.pl-sok{color: #B294BB!important}.pl-sol{color: #B5BD68!important}.pl-som{color: #C66!important}.pl-sr{color: #C66!important}.pl-sra{color: #B294BB!important}.pl-src{color: #B294BB!important}.pl-sre{color: #B294BB!important}.pl-st{color: #B294BB!important}.pl-stj{color: #c5c8c6!important}.pl-stp{color: #DE935F!important}.pl-sv{color: #DE935F!important}.pl-v{color: #DE935F!important}.pl-vi{color: #DE935F!important}.pl-vo{color: #C66!important}.pl-vpf{color: #DE935F!important}.pl-mi1{color: #8F9D6A!important;background: rgba(0,64,0,.5)!important}.pl-mdht{color: #8F9D6A!important;background: rgba(0,64,0,.5)!important}.pl-md{color: #C66!important;background: rgba(64,0,0,.5)!important}.pl-mdhf{color: #C66!important;background: rgba(64,0,0,.5)!important}.pl-mdr{color: #DE935F!important;font-weight: 400!important}.pl-mdh{color: #C66!important;font-weight: 400!important}.pl-mdi{color: #C66!important;font-weight: 400!important}.pl-ib{background-color: #C66!important}.pl-id{background-color: #C66!important;color: #fff!important}.pl-ii{background-color: #C66!important;color: #fff!important}.pl-iu{background-color: #C66!important}.pl-mo{color: #c5c8c6!important}.pl-mri{color: #DE935F!important}.pl-ms1{background-color: #c5c8c6!important}.pl-va{color: #DE935F!important}.pl-vpu{color: #DE935F!important}.pl-entl{color: #c5c8c6!important}.CodeMirror-gutters{background: #222!important;border-right: 1px solid #484848!important}.CodeMirror-guttermarker{color: #fff!important}.CodeMirror-guttermarker-subtle{color: #aaa!important}.CodeMirror-linenumber{color: #aaa!important}.CodeMirror-cursor{border-left: 1px solid #fff!important}.CodeMirror-activeline-background{background: #27282E!important}.CodeMirror-matchingbracket{outline: 1px solid grey!important;color: #fff!important}.cm-keyword{color: #f9ee98!important}.cm-atom{color: #FC0!important}.cm-number{color: #ca7841!important}.cm-def{color: #8DA6CE!important}.cm-variable-2,span.cm-tag{color: #607392!important}.cm-variable-3,span.cm-def{color: #607392!important}.cm-operator{color: #cda869!important}.cm-comment{color: #777!important;font-style: italic!important;font-weight: 400!important}.cm-string{color: #8f9d6a!important}.cm-string-2{color: #bd6b18!important}.cm-meta{background-color: #141414!important;color: #f7f7f7!important}.cm-builtin{color: #cda869!important}.cm-tag{color: #997643!important}.cm-attribute{color: #d6bb6d!important}.cm-header{color: #FF6400!important}.cm-hr{color: #AEAEAE!important}.cm-link{color: #ad9361!important;font-style: italic!important;text-decoration: none!important}.cm-error{border-bottom: 1px solid red!important}#notebook .highlight table{background: #1d1f21!important;color: #c5c8c6!important}.highlight .hll{background-color: #373b41!important}.highlight .c{color: #969896!important}.highlight .err{color: #c66!important}.highlight .k{color: #b294bb!important}.highlight .l{color: #de935f!important}.highlight .h,.highlight .n{color: #c5c8c6!important}.highlight .o{color: #8abeb7!important}.highlight .p{color: #c5c8c6!important}.highlight .cm{color: #969896!important}.highlight .cp{color: #969896!important}.highlight .c1{color: #969896!important}.highlight .cs{color: #969896!important}.highlight .gd{color: #c66!important}.highlight .ge{font-style: italic!important}.highlight .gh{color: #c5c8c6!important;font-weight: 700!important}.highlight .gi{color: #b5bd68!important}.highlight .gp{color: #969896!important;font-weight: 700!important}.highlight .gs{font-weight: 700!important}.highlight .gu{color: #8abeb7!important;font-weight: 700!important}.highlight .kc{color: #b294bb!important}.highlight .kd{color: #b294bb!important}.highlight .kn{color: #8abeb7!important}.highlight .kp{color: #b294bb!important}.highlight .kr{color: #b294bb!important}.highlight .kt{color: #f0c674!important}.highlight .ld{color: #b5bd68!important}.highlight .m{color: #de935f!important}.highlight .s{color: #b5bd68!important}.highlight .na{color: #81a2be!important}.highlight .nb{color: #c5c8c6!important}.highlight .nc{color: #f0c674!important}.highlight .no{color: #c66!important}.highlight .nd{color: #8abeb7!important}.highlight .ni{color: #c5c8c6!important}.highlight .ne{color: #c66!important}.highlight .nf{color: #81a2be!important}.highlight .nl{color: #c5c8c6!important}.highlight .nn{color: #f0c674!important}.highlight .nx{color: #81a2be!important}.highlight .py{color: #c5c8c6!important}.highlight .nt{color: #8abeb7!important}.highlight .nv{color: #c66!important}.highlight .ow{color: #8abeb7!important}.highlight .w{color: #c5c8c6!important}.highlight .mf{color: #de935f!important}.highlight .mh{color: #de935f!important}.highlight .mi{color: #de935f!important}.highlight .mo{color: #de935f!important}.highlight .sb{color: #b5bd68!important}.highlight .sc{color: #c5c8c6!important}.highlight .sd{color: #969896!important}.highlight .s2{color: #b5bd68!important}.highlight .se{color: #de935f!important}.highlight .sh{color: #b5bd68!important}.highlight .si{color: #de935f!important}.highlight .sx{color: #b5bd68!important}.highlight .sr{color: #b5bd68!important}.highlight .s1{color: #b5bd68!important}.highlight .ss{color: #b5bd68!important}.highlight .bp{color: #c5c8c6!important}.highlight .vc{color: #c66!important}.highlight .vg{color: #c66!important}.highlight .vi{color: #c66!important}.highlight .il{color: #de935f!important}
</style>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js" integrity="sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp faster">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://nathanielbd.github.io">nathanielbd</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://nathanielbd.github.io/posts/">Posts</a>
				<a href="https://nathanielbd.github.io/about">About</a>
				<a href="https://nathanielbd.github.io/projects">Projects</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://github.com/nathanielbd" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://linkedin.com/in/nathanielbd" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://twitter.com/nbudijono" target="_blank" rel="noopener me" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="mailto:nathanielbd@gmail.com" target="_blank" rel="noopener me" title="Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://nathanielbd.github.io/posts/">Posts</a></li>
			<li><a href="https://nathanielbd.github.io/about">About</a></li>
			<li><a href="https://nathanielbd.github.io/projects">Projects</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Mar 30, 2022</span></div>
				<h1>Learning Python Exceptions through Lenstra&#39;s Algorithm</h1>
			</header>
			<div class="content">
				<p><em>This is part two of my series on Lenstra&rsquo;s Algorithm. See part one <a href="https://nathanielbd.github.io/posts/algorithm-built-to-fail/">here</a> for the intuition for the algorithm.</em></p>
<hr>
<p>In part one, we saw that Lenstra&rsquo;s Algorithm can intuitively be understood as an algorithm literally built to fail. 
We repeatedly add a point to itself on an elliptic curve modulo the number to be factored and wait until a failure
to compute a modular multiplicative inverse occurs. Because when that happens, it means that the GCD of the number
to be factored and another number is non-zero. The latter number must be a factor of the former! We&rsquo;ll see that this
pattern of waiting for a failure to occur and handling it is exactly what exceptions help us do in the Python programming
language. Along the way, let&rsquo;s also dig deeper into the subroutines and implementation details of the algorithm.</p>
<h1 id="what-are-exceptions">What are exceptions?<a href="#what-are-exceptions" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">try</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span>
<span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Can&#39;t divide by zero!&#34;</span><span class="p">)</span>
</code></pre></div><p>In the above code block, if <code>x</code> is ever <code>0</code>, we will &lsquo;throw&rsquo; a <code>ZeroDivisionError</code> exception. When an exception occurs
within a <code>try</code> block, it must be &lsquo;caught&rsquo; with an <code>except</code> block. When the exception is caught, the code within the 
<code>except</code> block is executed instead of the code within the <code>try</code> block.</p>
<p>What&rsquo;s even more interesting is the behavior in Python if there isn&rsquo;t an <code>except</code> block immediately after the <code>try</code> block.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">invert</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span>

<span class="k">def</span> <span class="nf">quadratic_formula</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">determ</span> <span class="o">=</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span>
        <span class="n">over_neg_two_a</span> <span class="o">=</span> <span class="n">invert</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">determ</span><span class="p">))</span><span class="o">*</span><span class="n">over_neg_two_a</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">determ</span><span class="p">))</span><span class="o">*</span><span class="n">over_neg_two_a</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;That isn&#39;t even a quadratic function, silly!&#34;</span><span class="p">)</span>

<span class="n">quadratic_formula</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div><p>If we run this code, we first call <code>quadratic_formula</code>. It will then call <code>invert</code> in its <code>try</code> block. Next, <code>invert</code> will end up throwing a <code>ZeroDivisionError</code> because
<code>0</code> is passed in as <code>x</code>. <code>invert</code> doesn&rsquo;t have an <code>except</code> block, so we look for what function called <code>invert</code>, which is <code>quadratic_formula</code>.</p>
<p><code>quadratic_formula</code> actually does have an <code>except</code> block! Our exception is finally caught.</p>
<h1 id="lets-program-lenstras-algorithm-in-python">Let&rsquo;s program Lenstra&rsquo;s algorithm in Python<a href="#lets-program-lenstras-algorithm-in-python" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>We seek to factor the integer \(N\) using trying different points \(P = (a, b)\) on the elliptic curve</p>
<p>$$
E: Y^2 = X^3 + AX + B \mod N
$$</p>
<p>where \(B = b^2 - a^3 - Aa \mod N\). Suppose we will try \(k\) different points for now.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">lenstras</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># compute the next point Q by adding P to itself</span>
            <span class="c1"># throw a NonUnityGCDEvent exception when a GCD is not 1</span>
        <span class="k">except</span> <span class="n">NonUnityGCDEvent</span><span class="p">:</span>
            <span class="c1"># catch the exception and return the nontrivial factor of N</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">Q</span>
</code></pre></div><p>As stated in part 1, it&rsquo;s actually faster to compute \(Q = n!P\) for the \(n\)th iteration of the loop instead of repeated addition \(Q = P + P + \dots P = nP\).</p>
<h2 id="the-double-and-add-algorithm">The double-and-add algorithm<a href="#the-double-and-add-algorithm" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>For \(n! = m_0 \cdot m_1 \dots m_{n+1}\), the fastest way to compute each \(m_i P\) is via the double-and-add algorithm. We&rsquo;ll repeat it to compute \(n!\).</p>
<p>The basic idea is to use the binary expansion of \(m_i\).</p>
<p>$$
m_i = r_0 + r_1 \cdot 2 + r_2 \cdot 4 + r_3 \cdot 8 + \dots r_j 2^j.
$$</p>
<p>Take \(n=42\) as an example. Represented in binary, it&rsquo;s 101010.</p>
<p>$$
\begin{aligned}
n &amp;= 2^5 + 0 + 2^3 + 0 + 2^1 + 0 \newline
&amp;= 32 + 8 + 2\newline
&amp;= 42.
\end{aligned}
$$</p>
<p>How can we turn the evaluation of this expansion into an algorithm?</p>
<table>
<thead>
<tr>
<th align="center">
 <video controls width='80%'><source src='/DoubleAdd.mp4'></video></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">A walkthrough of the algorithm on the example. Notice how this uses 8 additions instead of the 41 additions required from the naive approach of computing \(nP\). Can you justify why this algorithm has a time complexity of \(O(\log_2(n))\) versus \(O(n)\) for the naive approach? <a href="https://gist.github.com/nathanielbd/f45970af570c74dc9676a3fd4b9b728c">Animation code</a></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">double_add</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">P</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># could alternatively do </span>
        <span class="c1"># n &amp; 1</span>
        <span class="c1"># if you&#39;re into the bitwise and operator</span>
        <span class="k">if</span> <span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span> 
            <span class="c1"># we&#39;ll replace this with elliptic curve point addition later</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">Q</span> 
        <span class="c1"># again, this will be replaced with point addition</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span>
        <span class="c1"># shift the bits right one</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">R</span> <span class="c1"># R = nP</span>
</code></pre></div><p>Alternatively, we can implement the algorithm without bitshifting and a binary representation altogether.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">double_add</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">P</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># we&#39;re really just checking if the number is odd</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">Q</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">Q</span>
        <span class="c1"># the bitshift is equivalent to halving and flooring</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>
</code></pre></div><h3 id="elliptic-curve-point-addition">Elliptic curve point addition<a href="#elliptic-curve-point-addition" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>The algorithm for point addition is given in <a href="https://nathanielbd.github.io/posts/algorithm-built-to-fail/#elliptic-curve-addition-algorithm">part 1</a>. To summarize, we solve for the third intersection between the secant line and the elliptic curve. If it&rsquo;s a point doubling, we solve for the second intersection between the tangent line and the elliptic curve. Otherwise, we handle special cases with the identity element at infinity.</p>
<table>
<thead>
<tr>
<th align="center">
 <video controls width='80%'><source src='/PointAddition.mp4'></video> </th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Recall point addition for the usual case of two distinct points.</td>
</tr>
</tbody>
</table>
<p>As the focus of this post is to illustrate how Python exceptions match our intuition of how the algorithm handles failures, let&rsquo;s simply translate the algorithm into Python without delving into the details outlined in the previous post.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">pt_add</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">P</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Q</span>
    <span class="k">if</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">P</span>
    <span class="n">x_p</span><span class="p">,</span> <span class="n">y_p</span> <span class="o">=</span> <span class="n">P</span>
    <span class="n">x_q</span><span class="p">,</span> <span class="n">y_q</span> <span class="o">=</span> <span class="n">Q</span>
    <span class="c1"># special case where the points share an x-coordinate</span>
    <span class="c1"># the secant line is vertical, so the identity element is </span>
    <span class="c1"># considered the intersection</span>
    <span class="k">if</span> <span class="n">x_p</span> <span class="o">==</span> <span class="n">x_q</span> <span class="ow">and</span> <span class="n">y_p</span> <span class="o">==</span> <span class="o">-</span><span class="n">y_q</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># point doubling</span>
    <span class="k">if</span> <span class="n">P</span> <span class="o">==</span> <span class="n">Q</span><span class="p">:</span>
        <span class="c1"># division will require finding modular multiplicative</span>
        <span class="c1"># inverse with the extended Euclidean algorithm</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">x_p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">y_1</span><span class="p">)</span>
    <span class="c1"># distinct points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># again, we will replace division with a call to</span>
        <span class="c1"># the extended Euclidean algorithm</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_q</span> <span class="o">-</span> <span class="n">y_p</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x_q</span> <span class="o">-</span> <span class="n">x_p</span><span class="p">)</span>
    <span class="n">x_r</span> <span class="o">=</span> <span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x_1</span> <span class="o">-</span> <span class="n">x_2</span>
    <span class="n">y_r</span> <span class="o">=</span> <span class="n">lam</span><span class="o">*</span><span class="p">(</span><span class="n">x_p</span> <span class="o">-</span> <span class="n">x_r</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_p</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_r</span><span class="p">,</span> <span class="n">y_r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>
</code></pre></div><h3 id="the-extended-euclidean-algorithm">The extended Euclidean algorithm<a href="#the-extended-euclidean-algorithm" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p><a href="https://nathanielbd.github.io/posts/algorithm-built-to-fail/#extended-euclidean-algorithm">In part 1</a>, we discuss a memory-inefficient implementation of the extended Euclidean algorithm. Let&rsquo;s revisit the example to see why it&rsquo;s inefficient.</p>
<p>$$
21u + 71v = \gcd(21, 71)
$$</p>
<table>
<thead>
<tr>
<th align="center">Divide, find remainder, repeat</th>
<th align="center">Construct BÃ©zout coefficients \(u\) and \(v\)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">\(\begin{aligned} 71 &amp;= 3 \cdot 21 + 8 \newline 21 &amp;= 2 \cdot 8 + 5 \newline 8 &amp;= 1 \cdot 5 + 3 \newline 5 &amp;= 1 \cdot 3 + 2 \newline 3 &amp;= 1 \cdot 2 + 1 \newline 2 &amp;= 2 \cdot 1 + 0 \newline \end{aligned}\)</td>
<td align="center">\(\begin{aligned} 8 &amp;= 1 \cdot 71 + -3 \cdot 21 \newline 5 &amp;= 0 \cdot 71 + 1 \cdot 21 - 2 (1 \cdot 71 + -3 \cdot 21) = -2 \cdot 71 + 7 \cdot 21 \newline 3 &amp;= 1 \cdot 71 + -3 \cdot 21 - 1 (-2 \cdot 71 + 7 \cdot 21) = 3 \cdot 71 + -10 \cdot 21 \newline 2 &amp;= -2 \cdot 71 + 7 \cdot 21 - 1 (3 \cdot 71 + -10 \cdot 21) = -5 \cdot 71 + 17 \cdot 21 \newline 1 &amp;= 3 \cdot 71 + -10 \cdot 21 - 1 (-5 \cdot 71 + 17 \cdot 21) = 8 \cdot 71 + -27 \cdot 21 \end{aligned}\)</td>
</tr>
<tr>
<td align="center">In part 1, we went over the procedure of dividing by the remainder repeatedly. This results in a decreasing sequence of remainders. Instead of storing the entire sequence, we can get away with only storing the two most recently computed remainders.</td>
<td align="center">Part 1 also considers a second calculation of rewriting each remainder step in order to construct the coefficients. Not only can we again store only the most recently computed coefficients, but we can also compute them in parallel with the remainders instead of after.</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">extended_euclidean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">prev_r</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
    <span class="n">prev_u</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">prev_v</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># integer/floor division</span>
        <span class="n">quotient</span> <span class="o">=</span> <span class="n">prev_r</span> <span class="o">//</span> <span class="n">r</span>
        <span class="c1"># algebra required to solve for the variable</span>
        <span class="c1"># at each iteration, using parallel assignment</span>
        <span class="n">prev_r</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">prev_r</span> <span class="o">-</span> <span class="n">quotient</span><span class="o">*</span><span class="n">r</span>
        <span class="n">prev_u</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">,</span> <span class="n">prev_u</span> <span class="o">-</span> <span class="n">quotient</span><span class="o">*</span><span class="n">u</span>
        <span class="n">prev_v</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">prev_v</span> <span class="o">-</span> <span class="n">quotient</span><span class="o">*</span><span class="n">v</span>
    
    <span class="c1"># since the loop will terminate on a zero </span>
    <span class="c1"># remainder, return the coefficients before that</span>
    <span class="k">return</span> <span class="n">prev_u</span><span class="p">,</span> <span class="n">prev_v</span>
</code></pre></div><p>Revisiting the same example&hellip;</p>
<table>
<thead>
<tr>
<th align="center">Step</th>
<th align="center"><code>quotient</code></th>
<th align="center"><code>prev_r</code></th>
<th align="center"><code>r</code></th>
<th align="center"><code>prev_u</code></th>
<th align="center"><code>u</code></th>
<th align="center"><code>prev_v</code></th>
<th align="center"><code>v</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">undefined</td>
<td align="center">71</td>
<td align="center">21</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">21</td>
<td align="center">8</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">-3</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">8</td>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">-2</td>
<td align="center">-3</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">3</td>
<td align="center">-2</td>
<td align="center">3</td>
<td align="center">7</td>
<td align="center">-10</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">-5</td>
<td align="center">-10</td>
<td align="center">17</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">-5</td>
<td align="center">8</td>
<td align="center">17</td>
<td align="center">-27</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">8</td>
<td align="center">-13</td>
<td align="center">-27</td>
<td align="center">44</td>
</tr>
</tbody>
</table>
<p>Notice that the <code>r</code> column is decreasing. It terminates at 0, consistent with our while loop logic. Comparing to the previous table with our naive approach, we can see the same coefficients being computed.</p>
<p>There&rsquo;s another optimization we can do that will allow us to save memory by not storing <code>prev_v</code> and <code>v</code>, since we can solve for the second coefficient after computing the first. We will leave that aside for now.</p>
<h4 id="computing-a-modular-multiplicative-inverse">Computing a modular multiplicative inverse<a href="#computing-a-modular-multiplicative-inverse" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<p>Next, we&rsquo;ll do the necessary modifications to the extended Euclidean algorithm for it to compute modular multiplicative inverses. Recall from part 1 that we can only compute the modular multiplicative inverse of \(a \mod b\) if \(\gcd(a, b) = 1\).</p>
<p>$$
\begin{aligned}
au + bv &amp;= \gcd(a, b) \newline
au + bv &amp;= 1 \newline
au - 1 &amp;= -bv \newline
au - 1 &amp;\equiv 0 \mod b \newline
au &amp;\equiv 1 \mod b.
\end{aligned}
$$</p>
<p>Now we can apply the final optimization, since we only need one coefficient anyways.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">mod_mult_inverse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">prev_r</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>
    <span class="n">prev_inv</span><span class="p">,</span> <span class="n">inv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">quotient</span> <span class="o">=</span> <span class="n">prev_r</span> <span class="o">//</span> <span class="n">new_r</span>
        <span class="n">prev_inv</span><span class="p">,</span> <span class="n">inv</span> <span class="o">=</span> <span class="n">inv</span><span class="p">,</span> <span class="n">prev_inv</span> <span class="o">-</span> <span class="n">quotient</span><span class="o">*</span><span class="n">inv</span>
        <span class="n">prev_r</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">prev_r</span> <span class="o">-</span> <span class="n">quotient</span><span class="o">*</span><span class="n">r</span>

    <span class="k">if</span> <span class="n">prev_r</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># the last non-zero remainder will be our GCD</span>
        <span class="c1"># if it is not one, we fail to compute the inverse</span>
        <span class="c1"># raise an exception to be handled upstream in</span>
        <span class="c1"># order to report the failure and capture our</span>
        <span class="c1"># non-trivial factor    </span>
        <span class="k">raise</span> <span class="n">NonUnityGCDEvent</span><span class="p">(</span><span class="n">prev_r</span><span class="p">)</span> <span class="c1"># &lt;-- Exception starts here (1)</span>
        <span class="c1"># notice we pass prev_r (the non-unity GCD and non-trivial</span>
        <span class="c1"># factor) as extra information</span>
    <span class="k">if</span> <span class="n">inv</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># the coefficient might be negative</span>
        <span class="c1"># in this case, find its equivalent modulo b</span>
        <span class="n">inv</span> <span class="o">+=</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">inv</span>

<span class="c1"># create our own custom exception</span>
<span class="k">class</span> <span class="nc">NonUnityGCDEvent</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    Exception to be raised during computations in Lenstra&#39;s algorithm.
</span><span class="s2">    Attributes:
</span><span class="s2">        d -- integer GCD 1 &lt; d &lt;= N resulting from computation of a modular multiplicative inverse
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Found non-unity GCD d&#34;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</code></pre></div><h1 id="conclusion">Conclusion<a href="#conclusion" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>Finally, we can see the rest of the Python code with modifications and trace the event back up.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">pt_add</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">P</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Q</span>
    <span class="k">if</span> <span class="n">Q</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">P</span>
    <span class="n">x_p</span><span class="p">,</span> <span class="n">y_p</span> <span class="o">=</span> <span class="n">P</span>
    <span class="n">x_q</span><span class="p">,</span> <span class="n">y_q</span> <span class="o">=</span> <span class="n">Q</span>
    <span class="k">if</span> <span class="n">x_p</span> <span class="o">==</span> <span class="n">x_q</span> <span class="ow">and</span> <span class="n">y_p</span> <span class="o">==</span> <span class="o">-</span><span class="n">y_q</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># point doubling</span>
    <span class="k">if</span> <span class="n">P</span> <span class="o">==</span> <span class="n">Q</span><span class="p">:</span>
        <span class="c1"># division now replaced with finding the modular</span>
        <span class="c1"># multiplicative inverse</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">x_p</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">mod_mult_inverse</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">y_1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="c1"># &lt;-- Exception rises here, and continues to rise as there is no `except` block (2)</span>
    <span class="c1"># distinct points</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># again division replaced with the modular</span>
        <span class="c1"># multiplicative inverse</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_q</span> <span class="o">-</span> <span class="n">y_p</span><span class="p">)</span><span class="o">*</span><span class="n">mod_mult_inverse</span><span class="p">(</span><span class="n">x_q</span> <span class="o">-</span> <span class="n">x_p</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="c1"># &lt;-- Or rises here, depending on where it was called (2)</span>
    <span class="n">x_r</span> <span class="o">=</span> <span class="n">lam</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">x_1</span> <span class="o">-</span> <span class="n">x_2</span>
    <span class="n">y_r</span> <span class="o">=</span> <span class="n">lam</span><span class="o">*</span><span class="p">(</span><span class="n">x_p</span> <span class="o">-</span> <span class="n">x_r</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_p</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_r</span><span class="p">,</span> <span class="n">y_r</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">R</span>

<span class="k">def</span> <span class="nf">double_add</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">P</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># replaced addition operator with elliptic</span>
            <span class="c1"># curve point addition function</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">pt_add</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="c1"># &lt;-- Exception rises here next, as it called pt_add (3)</span>
        <span class="c1"># replaced multiplication by two with elliptic</span>
        <span class="c1"># curve point addition function</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">pt_add</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="c1"># &lt;-- Or exception rises here next, if we were in the middle of point doubling when the non-unity GCD was found (3)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">R</span>

<span class="k">def</span> <span class="nf">lenstras</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">double_add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="c1"># &lt;-- Exception rises to the top of the call stack, where there is an `except` block (4)</span>
        <span class="k">except</span> <span class="n">NonUnityGCDEvent</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># catch the exception and return the non-trivial factor of N</span>
            <span class="k">return</span> <span class="n">e</span><span class="o">.</span><span class="n">d</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">Q</span>
    <span class="c1"># computation of k!P did not result in a non-trivial factor</span>
    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div><p>You can see that the exceptions allow the computer implementation of the algorithm to follow the same flow as you would if you were performing Lenstra&rsquo;s algorithm by hand; you would go down elliptic curve/modular arithmetic rabbit hole until you found the factor by failure, remembered what led you down that particular hole, and immediately stop. An implementation without exceptions would require unnecessary returning of a flag indicating failure through all of the helper functions, then checking it at the top of the call stack and computing the GCD. It doesn&rsquo;t evoke the intuition of computing by failure or the thought process of a human performing the algorithm at all.</p>
<h1 id="anticipated-questions">Anticipated questions<a href="#anticipated-questions" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h1>
<p>What if you don&rsquo;t find any factors after \(k\) tries? Or if \(d = N\)?</p>
<ul>
<li>You pick a different curve. There are <a href="https://en.wikipedia.org/wiki/Lenstra_elliptic-curve_factorization#Why_does_the_algorithm_work?">a few factors</a> that affect how likely it is to encounter a division failure during calculations, but they are out of scope of this already quite long blog post. The bottom line is picking a curve and starting point gives us another chance at finding a subgroup with a number of elements that&rsquo;s &ldquo;smooth&rdquo; &mdash;has small prime factors&mdash; which will allow us to get a division failure quicker.</li>
</ul>
<hr>
<p><em>I learned this algorithm from an excellant textbook, &lsquo;An Introduction to Mathematical Cryptography&rsquo; by Hoffstein, Pipher, and Silverman. You can view Python implementations of selected algorithms from that textbook, including the one we just went over, <a href="https://github.com/nathanielbd/HPS-crypto">here</a></em></p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://nathanielbd.github.io/tags/programming">programming</a></span><span class="tag"><a href="https://nathanielbd.github.io/tags/computational-number-theory">computational number theory</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>2360 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2022-03-30 16:04 -0500</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="prev-post" href="https://nathanielbd.github.io/posts/what-is-the-meta-logo/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>What is the Meta logo?</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2023 <a href="https://nathanielbd.github.io">Nathaniel Budijono</a></p>
		<p>
		</p>
	</footer>



	<script src="https://nathanielbd.github.io/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js" integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin="anonymous"></script>
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168359675-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


</body>

</html>
